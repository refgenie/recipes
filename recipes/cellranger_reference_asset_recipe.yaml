name: cellranger_reference
version: 0.0.1
output_asset_class: cellranger_reference
description:
  Cell Ranger custom genome reference for read alignment and gene expression
  quantification
input_files: {}
input_params:
  threads:
    default: "8"
    description: Number of threads to use for parallel computing
input_assets:
  gencode_gtf:
    asset_class: gtf
    default: gencode_gtf
    description: Annotation file in Gene Transfer Format (GTF) from Gencode
  fasta:
    asset_class: fasta
    default: fasta
    description: fasta asset for genome
docker_image: databio/refgenie
command_templates:
  - gunzip {{values.assets["gtf"].seek_keys_dict["gtf"]}} -c > {{values.output_folder}}/{{values.genome_digest}}.gtf
  - cellranger mkgtf {{values.output_folder}}/{{values.genome_digest}}.gtf {{values.output_folder}}/{{values.genome_digest}}_filtered.gtf
  - rm {{values.output_folder}}/{{values.genome_digest}}.gtf
  - cd {{values.output_folder}}; cellranger mkref --genome=ref --fasta={{values.assets["fasta"].seek_keys_dict["fasta"]}} --genes={{values.output_folder}}/{{values.genome_digest}}_filtered.gtf
    --nthreads={{values.params["threads"]}}
custom_properties:
  version: "cellranger --version | awk -F- '{print $2}'"
default_asset: "{{values.custom_properties.version}}"
